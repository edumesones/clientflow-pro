{"ast":null,"code":"import React,{useState,useEffect}from'react';import Calendar from'react-calendar';import{appointmentsAPI,availabilityAPI}from'../services/apiService';import'react-calendar/dist/Calendar.css';import'./CalendarPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CalendarPage=()=>{const[selectedDate,setSelectedDate]=useState(new Date());const[appointments,setAppointments]=useState([]);const[loading,setLoading]=useState(true);const[showModal,setShowModal]=useState(false);const[selectedSlot,setSelectedSlot]=useState(null);useEffect(()=>{fetchAppointments();},[selectedDate]);const fetchAppointments=async()=>{try{const startOfMonth=new Date(selectedDate.getFullYear(),selectedDate.getMonth(),1);const endOfMonth=new Date(selectedDate.getFullYear(),selectedDate.getMonth()+1,0);const response=await appointmentsAPI.getAll({start_date:startOfMonth.toISOString().split('T')[0],end_date:endOfMonth.toISOString().split('T')[0]});setAppointments(response.data);}catch(error){console.error('Error fetching appointments:',error);}finally{setLoading(false);}};const getAppointmentsForDate=date=>{const dateStr=date.toISOString().split('T')[0];return appointments.filter(appt=>appt.appointment_date===dateStr);};const handleDateClick=date=>{setSelectedDate(date);setShowModal(true);};const tileContent=_ref=>{let{date,view}=_ref;if(view==='month'){const dayAppointments=getAppointmentsForDate(date);if(dayAppointments.length>0){return/*#__PURE__*/_jsxs(\"div\",{className:\"calendar-dots\",children:[dayAppointments.slice(0,3).map((appt,idx)=>/*#__PURE__*/_jsx(\"span\",{className:\"dot dot-\".concat(appt.status)},idx)),dayAppointments.length>3&&/*#__PURE__*/_jsx(\"span\",{className:\"dot-more\",children:\"+\"})]});}}return null;};const formatDate=date=>{return date.toLocaleDateString('es-ES',{weekday:'long',year:'numeric',month:'long',day:'numeric'});};return/*#__PURE__*/_jsxs(\"div\",{className:\"calendar-page\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Calendario de Citas\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"calendar-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"calendar-wrapper\",children:[/*#__PURE__*/_jsx(Calendar,{onChange:handleDateClick,value:selectedDate,tileContent:tileContent,className:\"custom-calendar\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"calendar-legend\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"dot dot-confirmed\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Confirmada\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"dot dot-pending\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Pendiente\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"dot dot-completed\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Completada\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"dot dot-cancelled\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Cancelada\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"appointments-sidebar\",children:[/*#__PURE__*/_jsx(\"h2\",{children:formatDate(selectedDate)}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"}):/*#__PURE__*/_jsx(\"div\",{className:\"day-appointments\",children:getAppointmentsForDate(selectedDate).length===0?/*#__PURE__*/_jsx(\"p\",{className:\"no-appointments\",children:\"No hay citas para este d\\xEDa\"}):getAppointmentsForDate(selectedDate).map(appt=>{var _appt$client;return/*#__PURE__*/_jsxs(\"div\",{className:\"day-appointment-item status-\".concat(appt.status),children:[/*#__PURE__*/_jsx(\"div\",{className:\"appointment-time\",children:appt.start_time}),/*#__PURE__*/_jsxs(\"div\",{className:\"appointment-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:((_appt$client=appt.client)===null||_appt$client===void 0?void 0:_appt$client.full_name)||appt.lead_name||'Sin nombre'}),/*#__PURE__*/_jsx(\"p\",{children:appt.service_type||'Consulta general'})]}),/*#__PURE__*/_jsx(\"span\",{className:\"status-badge status-\".concat(appt.status),children:appt.status})]},appt.id);})})]})]})]});};export default CalendarPage;","map":{"version":3,"names":["React","useState","useEffect","Calendar","appointmentsAPI","availabilityAPI","jsx","_jsx","jsxs","_jsxs","CalendarPage","selectedDate","setSelectedDate","Date","appointments","setAppointments","loading","setLoading","showModal","setShowModal","selectedSlot","setSelectedSlot","fetchAppointments","startOfMonth","getFullYear","getMonth","endOfMonth","response","getAll","start_date","toISOString","split","end_date","data","error","console","getAppointmentsForDate","date","dateStr","filter","appt","appointment_date","handleDateClick","tileContent","_ref","view","dayAppointments","length","className","children","slice","map","idx","concat","status","formatDate","toLocaleDateString","weekday","year","month","day","onChange","value","_appt$client","start_time","client","full_name","lead_name","service_type","id"],"sources":["/home/lobster/.openclaw/workspace/clientflow-pro/frontend/src/pages/CalendarPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Calendar from 'react-calendar';\nimport { appointmentsAPI, availabilityAPI } from '../services/apiService';\nimport 'react-calendar/dist/Calendar.css';\nimport './CalendarPage.css';\n\nconst CalendarPage = () => {\n  const [selectedDate, setSelectedDate] = useState(new Date());\n  const [appointments, setAppointments] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [showModal, setShowModal] = useState(false);\n  const [selectedSlot, setSelectedSlot] = useState(null);\n\n  useEffect(() => {\n    fetchAppointments();\n  }, [selectedDate]);\n\n  const fetchAppointments = async () => {\n    try {\n      const startOfMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);\n      const endOfMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 0);\n      \n      const response = await appointmentsAPI.getAll({\n        start_date: startOfMonth.toISOString().split('T')[0],\n        end_date: endOfMonth.toISOString().split('T')[0],\n      });\n      \n      setAppointments(response.data);\n    } catch (error) {\n      console.error('Error fetching appointments:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getAppointmentsForDate = (date) => {\n    const dateStr = date.toISOString().split('T')[0];\n    return appointments.filter(appt => appt.appointment_date === dateStr);\n  };\n\n  const handleDateClick = (date) => {\n    setSelectedDate(date);\n    setShowModal(true);\n  };\n\n  const tileContent = ({ date, view }) => {\n    if (view === 'month') {\n      const dayAppointments = getAppointmentsForDate(date);\n      if (dayAppointments.length > 0) {\n        return (\n          <div className=\"calendar-dots\">\n            {dayAppointments.slice(0, 3).map((appt, idx) => (\n              <span \n                key={idx} \n                className={`dot dot-${appt.status}`}\n              />\n            ))}\n            {dayAppointments.length > 3 && <span className=\"dot-more\">+</span>}\n          </div>\n        );\n      }\n    }\n    return null;\n  };\n\n  const formatDate = (date) => {\n    return date.toLocaleDateString('es-ES', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  return (\n    <div className=\"calendar-page\">\n      <h1>Calendario de Citas</h1>\n      \n      <div className=\"calendar-container\">\n        <div className=\"calendar-wrapper\">\n          <Calendar\n            onChange={handleDateClick}\n            value={selectedDate}\n            tileContent={tileContent}\n            className=\"custom-calendar\"\n          />\n          \n          <div className=\"calendar-legend\">\n            <div className=\"legend-item\">\n              <span className=\"dot dot-confirmed\"></span>\n              <span>Confirmada</span>\n            </div>\n            <div className=\"legend-item\">\n              <span className=\"dot dot-pending\"></span>\n              <span>Pendiente</span>\n            </div>\n            <div className=\"legend-item\">\n              <span className=\"dot dot-completed\"></span>\n              <span>Completada</span>\n            </div>\n            <div className=\"legend-item\">\n              <span className=\"dot dot-cancelled\"></span>\n              <span>Cancelada</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"appointments-sidebar\">\n          <h2>{formatDate(selectedDate)}</h2>\n          \n          {loading ? (\n            <p>Cargando...</p>\n          ) : (\n            <div className=\"day-appointments\">\n              {getAppointmentsForDate(selectedDate).length === 0 ? (\n                <p className=\"no-appointments\">No hay citas para este d√≠a</p>\n              ) : (\n                getAppointmentsForDate(selectedDate).map((appt) => (\n                  <div key={appt.id} className={`day-appointment-item status-${appt.status}`}>\n                    <div className=\"appointment-time\">{appt.start_time}</div>\n                    <div className=\"appointment-details\">\n                      <h4>{appt.client?.full_name || appt.lead_name || 'Sin nombre'}</h4>\n                      <p>{appt.service_type || 'Consulta general'}</p>\n                    </div>\n                    <span className={`status-badge status-${appt.status}`}>\n                      {appt.status}\n                    </span>\n                  </div>\n                ))\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CalendarPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}